openapi: 3.0.0
info:
  title: API de Gestión de Proyectos
  version: 1.0.0
  description: Documentación completa de la API de proyectos, incluyendo endpoints CRUD y análisis de proyectos.

servers:
  - url: http://localhost:3000
    description: Servidor local de desarrollo

paths:

  /api/proyectos:
    get:
      summary: Obtener todos los proyectos
      description: Devuelve un array con todos los proyectos registrados.
      responses:
        '200':
          description: Lista de proyectos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Proyecto'
              example:
                - id: 1
                  nombre: "Proyecto Alpha"
                  descripcion: "Proyecto de ejemplo Alpha"
                  fechaInicio: "2023-01-01T00:00:00.000Z"
                  fechaFin: "2023-12-31T00:00:00.000Z"
                  estado: "EN_PROGRESO"
                  creadoEn: "2023-01-01T08:00:00.000Z"
                  actualizadoEn: "2023-06-01T12:00:00.000Z"
        '500':
          description: Error interno del servidor
          content:
            application/json:
              example:
                status: 500
                message: "Ocurrió un error. Contacta al administrador del sistema."
                error: "InternalServerError"
                timestamp: "2025-10-20T09:44:32.287Z"

    post:
      summary: Crear un nuevo proyecto
      description: Crea un proyecto con los datos proporcionados.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProyectoInput'
            example:
              nombre: "Control Biológico Antracnosis"
              descripcion: "Evaluación in vitro e in vivo de nuevos fungicidas."
              fechaInicio: "2023-03-01T00:00:00.000Z"
              fechaFin: "2025-06-30T00:00:00.000Z"
              estado: "FINALIZADO"
      responses:
        '201':
          description: Proyecto creado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Proyecto'
              example:
                id: 26
                nombre: "Control Biológico Antracnosis"
                descripcion: "Evaluación in vitro e in vivo de nuevos fungicidas."
                fechaInicio: "2023-03-01T00:00:00.000Z"
                fechaFin: "2025-06-30T00:00:00.000Z"
                estado: "FINALIZADO"
                creadoEn: "2025-10-20T09:44:32.287Z"
                actualizadoEn: "2025-10-20T09:44:32.287Z"
        '400':
          description: Error de validación
          content:
            application/json:
              example:
                status: 400
                message: "El nombre del proyecto es obligatorio"
                error: "BadRequest"
                timestamp: "2025-10-20T09:44:32.287Z"

  /api/proyectos/{id}:
    get:
      summary: Obtener proyecto por ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID del proyecto a consultar
      responses:
        '200':
          description: Proyecto encontrado
          content:
            application/json:
              $ref: '#/components/schemas/Proyecto'
              example:
                id: 26
                nombre: "Control Biológico Antracnosis"
                descripcion: "Evaluación in vitro e in vivo de nuevos fungicidas."
                fechaInicio: "2023-03-01T00:00:00.000Z"
                fechaFin: "2025-06-30T00:00:00.000Z"
                estado: "FINALIZADO"
                creadoEn: "2025-10-20T09:44:32.287Z"
                actualizadoEn: "2025-10-20T09:44:32.287Z"
        '404':
          description: Proyecto no encontrado
          content:
            application/json:
              example:
                status: 404
                message: "Proyecto con id 99 no encontrado"
                error: "NotFound"
                timestamp: "2025-10-20T09:44:32.287Z"

    put:
      summary: Actualizar proyecto
      description: Actualiza los datos de un proyecto existente.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID del proyecto a actualizar
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProyectoInput'
            example:
              nombre: "Proyecto Beta Actualizado"
              descripcion: "Actualización del proyecto Beta"
              estado: "PAUSADO"
      responses:
        '200':
          description: Proyecto actualizado
          content:
            application/json:
              $ref: '#/components/schemas/Proyecto'
        '400':
          description: Error de validación
        '404':
          description: Proyecto no encontrado

    delete:
      summary: Eliminar proyecto
      description: Elimina un proyecto por ID.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID del proyecto a eliminar
      responses:
        '200':
          description: Proyecto eliminado exitosamente
          content:
            application/json:
              example:
                message: "Proyecto eliminado correctamente"
        '404':
          description: Proyecto no encontrado

  /api/proyectos/analisis:
    get:
      summary: Analizar proyectos
      description: Genera un resumen profesional de todos los proyectos.
      responses:
        '200':
          description: Resumen generado
          content:
            application/json:
              example:
                resumen: "Se identificaron 10 proyectos en progreso y 5 finalizados..."
        '500':
          description: Error interno
          content:
            application/json:
              example:
                status: 500
                message: "Ocurrió un error. Contacta al administrador del sistema."
                error: "InternalServerError"
                timestamp: "2025-10-20T09:44:32.287Z"

  /api/proyectos/graficos:
    get:
      summary: Cantidad de proyectos por estado
      description: Devuelve un array con la cantidad de proyectos agrupados por estado.
      responses:
        '200':
          description: Datos de proyectos por estado
          content:
            application/json:
              example:
                - estado: "EN_PROGRESO"
                  cantidad: 12
                - estado: "FINALIZADO"
                  cantidad: 5
        '500':
          description: Error interno
          content:
            application/json:
              example:
                status: 500
                message: "Ocurrió un error. Contacta al administrador del sistema."
                error: "InternalServerError"
                timestamp: "2025-10-20T09:44:32.287Z"

components:
  schemas:
    Proyecto:
      type: object
      properties:
        id:
          type: integer
        nombre:
          type: string
        descripcion:
          type: string
        fechaInicio:
          type: string
          format: date-time
        fechaFin:
          type: string
          format: date-time
          nullable: true
        estado:
          type: string
          enum: [EN_PROGRESO, FINALIZADO, PAUSADO, CANCELADO]
        creadoEn:
          type: string
          format: date-time
        actualizadoEn:
          type: string
          format: date-time

    ProyectoInput:
      type: object
      properties:
        nombre:
          type: string
        descripcion:
          type: string
        fechaInicio:
          type: string
          format: date-time
        fechaFin:
          type: string
          format: date-time
          nullable: true
        estado:
          type: string
          enum: [EN_PROGRESO, FINALIZADO, PAUSADO, CANCELADO]
      required:
        - nombre
        - descripcion
